% !TeX program = xelatex
%
%% retrotype.sty
%% Copyright 2024 Vladimir Arabadzhi
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   https://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX
% version 2008 or later.
%
% This work has the LPPL maintenance status `author-maintained'.
%
% The Author and Maintainer of this work is Vladimir Arabadzhi.
%
% This work consists of the following files:
%   retrotype.sty,
%   retrotype-guide.tex,
%   TT2020.fontspec.

\ProvidesPackage{retrotype}[2024/10/17]

\RequirePackage{comment}
\RequirePackage[autostyle=true]{csquotes}
\RequirePackage{eso-pic}
\RequirePackage%[showframe]% <- uncomment for debugging
	{geometry}
\RequirePackage{graphicx}
\RequirePackage{multicol}
\RequirePackage{ifthen}
\RequirePackage{indentfirst}
\RequirePackage{tikz}


%%%%%%%%
% FONT %
%%%%%%%%

\RequirePackage{fontspec}

\setmainfont{TT2020}% TT2020.fontspec
\setmonofont{TT2020}% TT2020.fontspec
\renewcommand{\familydefault}{\ttdefault}

\newlength{\charwidth}
\settowidth{\charwidth}{\normalfont x}

% Document font size
\newlength{\docfontsize}
%\newlength{\docfontsizeInt}
\makeatletter
\setlength{\docfontsize}{\f@size pt}
\newcommand{\docfontsizeInt}{1\@ptsize}
\makeatother


%%%%%%%%
% PAGE %
%%%%%%%%

% \defaultGeometry
\makeatletter
\newlength{\retrotype@roughwidth}
\newlength{\retrotype@roughheight}
\newlength{\retrotype@textwidth}
\newlength{\retrotype@textheight}
\newcommand{\pagelayout}{undefined}
% default values
\def\retrotype@wratio{1.298}
\def\retrotype@hratio{1.28}

\newcommand{\defaultGeometry}{
	\ifdim\pdfpagewidth=210mm% A4
		\renewcommand{\pagelayout}{A4}
	\else
	\ifdim\pdfpagewidth=148mm% A5
		\renewcommand{\pagelayout}{A5}
	\else
	\ifdim\pdfpagewidth=8.5in% Letter or Legal
		\ifdim\pdfpageheight=11in% Letter
			\renewcommand{\pagelayout}{Letter}
			\ifcase\@ptsize% 10pt
			\or% 11pt
				\def\retrotype@wratio{1.28}
			\or% 12pt
			\fi
		\else% Legal
			\renewcommand{\pagelayout}{Legal}
			\ifcase\@ptsize% 10pt
			\or% 11pt
				\def\retrotype@wratio{1.28}
			\or% 12pt
			\fi
		\fi
	\else
	\ifdim\pdfpagewidth=7.25in% Executive
		\renewcommand{\pagelayout}{Executive}
		\ifcase\@ptsize% 10pt
			\def\retrotype@wratio{1.28}
		\or% 11pt
			\def\retrotype@wratio{1.28}
		\or% 12pt
			\def\retrotype@wratio{1.31}
		\fi
	\fi\fi\fi\fi
	
	% rough text dimensions
	\pgfmathsetlength{\retrotype@roughwidth}{\pdfpagewidth / \retrotype@wratio}
	\pgfmathsetlength{\retrotype@roughheight}{\pdfpageheight / \retrotype@hratio}
	% exact text dimensions
	\pgfmathsetlength{\retrotype@textwidth}{\charwidth * int(\retrotype@roughwidth / \charwidth)}
	\pgfmathsetlength{\retrotype@textheight}{\baselineskip * int(\retrotype@roughheight / \baselineskip)}
	
	\newgeometry{
		textwidth=\retrotype@textwidth,
		textheight=\retrotype@textheight,
		headsep=\baselineskip,
		footskip=\baselineskip,
		hmarginratio=1:1,
		vmarginratio=1:1,
	}% newgeometry
}
\makeatother

% START OF PAGE SETUP
\defaultGeometry{}
\AtBeginDocument{\setlength{\parsep}{0pt plus 0pt minus 0pt}}
\AtBeginDocument{\setlength{\parskip}{0pt plus 0pt minus 0pt}}
\AtBeginDocument{\setlength{\partopsep}{0pt plus 0pt minus 0pt}}
\AtBeginDocument{\setlength{\topsep}{0pt plus 0pt minus 0pt}}
\AtBeginDocument{\setlength{\parindent}{\tabchars\charwidth}}
\AtBeginDocument{\raggedright}
\AtBeginDocument{\frenchspacing}
\RequirePackage{setspace}
\AtBeginDocument{\singlespacing}
\AtBeginDocument{\setstretch{1}}
% END OF PAGE SETUP

% cpl - characters per line
\newcommand{\cpl}{\pgfmathparse{int(\textwidth/\charwidth)}\pgfmathresult}

% lpp - lines per page
\newcommand{\lpp}{\pgfmathparse{int(\textheight/\baselineskip)}\pgfmathresult}

% Clear to left page
\makeatletter
\newcommand*{\cleartoleftpage}{%
	\clearpage
	\if@twoside
		\ifodd\c@page
			\hbox{}\thispagestyle{empty}\newpage
			\if@twocolumn
				\hbox{}\thispagestyle{empty}\newpage
			\fi
		\fi
	\fi
}
\makeatother

% Clear to right page
\makeatletter
\newcommand*{\cleartorightpage}{%
	\clearpage
	\if@twoside
		\ifodd\c@page
		\else
			\hbox{}\thispagestyle{empty}\newpage
			\if@twocolumn
				\hbox{}\thispagestyle{empty}\newpage
			\fi
		\fi
	\fi
}
\makeatother


%%%%%%%%%%%
% SYMBOLS %
%%%%%%%%%%%

% dash
\def\dash{\raisebox{1.15ex}[0pt][0pt]{\_}}

% overline dash
\def\odash{\raisebox{2.25ex}[0pt][0pt]{\_}}

% tilde
\def\tld{\忉汶箪狍茕彐茆篼荇屮翕徙塍灬箬溴驷蹯扉铄汨狎徙翦ㄜ溽箬茕彐荇桢扉铄汨狎茕狍椠ゥゥゥゥ粤掠ゥゥゥゥ芤羼蹰蝈嗅汶徵妍翎怍稞葬忖轭麸骈邃痫箝糸镱茕彐荇徕汨狎竽彐狨祠待茕彐荇徕汨狎篼待茴鬻戾铉翳荇徕鏖漪椠轭轸獒扉邃轭荏弭葬庑矬轸轱铙茼犭遽綮弭翦荏弭葬庑矬糸镱篼铨汨犷珏溟篝犷沐忮赭邋翎篝镳麸汨狎徙翦蝮鏖溴犰箫躔溽翦荇徕汨狎犷荇徕鏖漪徙泔蜾轭珈茴鬻泔眄犷潲荏弭葬庑矬轸轱铙郾蓰茕彐茯弭蝻豉疱吏徕鏖漪梵茕彐茯弭蝻豉疱吏徕篚睇梆酏荀栝戾滹莒孱玺梏弩酐茯弭蝻豉疱吏徕篚莒轭鬻殇翳莛珂磲翳疳蝮妍１茔栳蝼殇翳茯弭蝻豉疱吏徕篚睚茗溴孳蝈趄雉疱吏徕篚睇莛珂磲翳蝈篚祠痿荛骧茯弭蝻豉疱吏徕鏖漪梵苠眇豉茗溴孳蝈趄雉疱吏徕鏖漪梵莛珂磲翳蝈篚祠痿苠祗茗溴孳蝈趄雉疱吏徕鏖漪梵茯弭蝻豉疱吏徕鏖漪梵莛珂磲翳蝈篚祠痿苕苠疳钿徭翦蜍葬庑矬轸轱铙苠疳钿徭翦螓茯弭蝻豉疱吏徕鏖漪梵茗溴孳翎忏栳蝮１莛珂磲翳箦綮孱玺棼荇徕鏖漪椠荇徕汨狎筌汨狎鏖漪椠荏弭悯篝镯葬庑矬轸轱铙扉篝翎脲扉篝镦泔眄岘箦疳蜥翦溟篝犷沐轭茔栳蝼殇翳犴秕铘麸躞狍翎篝镳滹弩蜗躔溽翦荇徕汨狎犷荇徕鏖漪箝钽翳翎怏汜忮溟篝犷沐躅羼踽祆茴鬻泔眄犷潲荏弭悯篝镯葬庑矬轸轱铙郾蓰茕彐茯弭蝻豉疱吏徕鏖漪梵茕彐茯弭蝻豉疱吏徕篚睇褒苕矧遽汨茗轭１莛珂磲翳疳蝮妍茗茔栳蝼殇翳茯弭蝻豉疱吏徕篚睚茗溴孳蝈趄雉疱吏徕篚睇莛珂磲翳蝈篚祠荛骧茯弭蝻豉疱吏徕鏖漪梵苠眇豉茗溴孳蝈趄雉疱吏徕鏖漪梵莛珂磲翳蝈篚祠痿苠祗茗溴孳蝈趄雉疱吏徕鏖漪梵茯弭蝻豉疱吏徕鏖漪梵莛珂磲翳蝈篚祠痿苕苠疳钿徭翦蜍葬庑矬轸轱铙苠疳钿徭翦螓茯弭蝻豉疱吏徕鏖漪梵茼犭遽麸翳弪茕彐狨祠葬庑矬轸轱铙蝈箦茉徕酗箝糸镱麸翳溴驷蹯镱弩ù汨狎徙翦蝮鏖溴茴鬻泔眄犷潲茕彐狨祠葬庑矬轸轱铙荏弭葬庑矬轸轱铙荇徕汨狎竽彐狨祠茕彐狨祠葬庑矬轸轱铙荇徕箴徙栾蜷镱翎箴徙羼踽麸翳沲蝌孱荇徕鏖漪茴鬻泔眄犷潲荇徕箴徙妪荑箴徙濯荇徕鏖漪椠ボ翎忸箅轲麸翳瞽翳翎猬泔躅糸铉骝镯翳沲蝌孱痫箝糸镱茴鬻泔眄犷潲荇徕铨郾蓰茴鬻泔躅糗殇荛澍奖莒镲荇徕荛骖蹴荛澍迹避徜鲠钽遘殇怡茯屦遽荛珙矧弩疳沐ゥゥゥゥゥゥ躺闻窍撂ゥゥゥゥゥゥ芤羼蹰蝈嗅汶徵妍扉铄顼犰骈轭翳莒轭彗镝骘翳箦泔钿泔祯眍梏麴蠛翦篝徙脲汨犷珏泔懑岑锤窗吵茼犭遽綮弭翦莒弭苴琅漓轭彗镝燔蝈灬躅溴骈铄翳痱镳弪豉茭蝈胬铄黟蝻皙扉铄顼犰圮扉铄鏖漪栎荇桢茕轫屮痱荛驿轫茕轫屮痱莒轭鬻殇翳荇桢莛滏灬篝痫箴荛骘滗茭蝈胬屮趄徙翡彐狨祠扉铄顼犰痫篪荇桢芴吻汤躅轳蹂疳珏茔鲤徵茱滗箝溴磲蜱轭苠祗遘弼孱箝溴磲蜱轭苕遍瞰荑镦骟弭茯屐狲及痿茔镬蹴铟殇翳茔镬蹴铙屦苕莒轭鬻殇翳荇桢莛滏灬篝痫箴荛骘滗茭蝈胬屮趄徙翡彐狨祠扉铄顼犰痫篪荇桢芴吻汤躅轳蹂疳珏茔鲤徵茱滗箝溴磲蜱轭苠祗遘弼孱箝溴磲蜱轭苕遍瞰荑镦骟弭茯屐狲扉铄顼犰蝈姝痱镳弪豉茼犭遽麸翳弪ゥゥゥゥ躺闻ゥゥゥゥ茯屦汨狎簖铨蝈疱狒翳汨狎糸礤茴鬻泔眄犷潲茯屦鄄蓰苕矧遽汨茴轭爆２１茼犭遽綮弭翦荏趄骈酐汨狎簖蝈趱蝾轭铛礅弪镦栾磲铢糸礤翳汨狎鏖祆骈轭麸翳蝈磲轭轭箴徙镱翳扉铄茴鬻戾铉翳茯弭蝻豉疱荔趄骈衾篝螨茴鬻戾铉翳茯弭蝻豉疱荔趄骈衾祛茴鬻泔眄犷潲荏趄骈酏郾蓰荏弭麸鏖漪棼茯弭蝻豉疱荔趄骈衾篝螨１荏弭戾铉翳茯弭蝻豉疱荔趄骈衾祛莒轭彗镝忑ツ怕涨报１┖篝蜊荇桢茯弭蝻豉疱荔趄骈衾篝蜉祛圮翳遘蝈趄雉疱荔趄骈衾祛蒈莛珂磲翳疳蝮妍轭舁茯弭蝻豉疱荔趄骈衾祛茯弭蝻豉疱荔趄骈衾篝颟ツ怕涨波莛珂磲翳蝈篚祠┸莛珂磲翳蝈篚祠茼犭遽麸翳弪莒轭邈栳蝮坫栳蝮蓰铨磲脲扉铄怡蝈疱狒轭翳汨狎糸礤茴鬻泔眄犷潲莒轭邈栳蝮鄄蒇荇桢扉铄汨狎蓰茴镩钿孱籁荇徕麸苊躜蝈铘涕铄组漪椠茯屦１２茼犭遽綮弭翦莒轭邈栳蝼坫栳蝮蓰鏖漪椠蝈疱狒翳汨狎骘翳玳鲥鏖漪茴鬻戾铉翳茯弭蝻豉疱漓轭邈栳蝼茴鬻泔眄犷潲莒轭邈栳蝼鄄蒇荇桢扉铄汨狎蓰荏弭麸鏖漪柢蝈趄雉疱漓轭邈栳蝼１莛珂磲翳疳蝮妍轭舁２茯弭蝻豉疱漓轭邈栳蝼爱氨痿轭篚骀殂殄铘戾铉翳骈荇徕麸苊躜蝈铘涕铄组漪椠荑箴徙濯茔栳蝼殇翳镦骟弭骈莒轭邈栳蝮郏陛莛珂磲翳蝈篚祠茼犭遽麸翳弪莒轭彐殪燠汨狎筝骈祆翳麒镬扉铄鏖翳汨狎茴鬻泔眄犷潲莒轭彐殪忑郾蒇荇桢扉铄汨狎蓰荇徕麸苊躜蝈铘涕铄组漪椠莒轭邈栳蝼郏陛茕轫屮痱莒轭鬻殇翳茉徕序弼酗螳爱叼糗蝈灬莛狎ゥゥゥゥゥゥゥ釉撩伺吻晌ゥゥゥゥゥゥゥ芤羼蹰蝈嗅汶徵妍篝徙脲铉轭妪茼犭遽綮弭翦茴鬻戾铉翳茯弭蝻豉疱荔趄鏖漪椠茱鲥蝠蜷铘猃汨狎簖秭弪痱轭镱麸镦犰汨狎螽茴鬻泔眄犷潲茱鲥蝠蜷铘鄄蓰荏弭麸鏖漪棼茯弭蝻豉疱荔趄鏖漪椠２莛蝻翦泗荏翎汶孱玳铄梆酏２莒轭邈栳蝼郏陛茯弭蝻豉疱荔趄鏖漪椠淆忑讫讫听茱鲥蝠蜷铘髹鏖漪栎猃秭弪痱轭骘翳玳鲥鏖漪镱翳扉铄怩泔铘轭蹂痱轭糸铉骝镯翳篝狎糸铉痫轭茴鬻泔眄犷潲茱鲥蝠蜷铘鼾鄄蒇莒轭彗镝燧荏弭戾铉翳茯弭蝻豉疱荔趄鏖漪椠１莛蝻翦泗荏翎汶孱玳铄梆酏莒轭邈栳蝼郏草茯弭蝻豉疱荔趄鏖漪椠淆忑讫札听茱鲥蝠蜷铘钲钶猃秭弪痱轭骘糸礤蟋怩泔铘轭蹂痱轭糸铉骝镯翳篝狎糸铉痫轭茴鬻泔眄犷潲茱鲥蝠蜷铘铨鄄蒇茔痨蓰荏弭戾铉翳茯弭蝻豉疱荔趄鏖漪椠１茔栳蝼殇翳莛蝻翦泗荏翎汶孱玳铄梆酏莒轭邈栳蝼郏草茯弭蝻豉疱荔趄鏖漪椠淆忑讫札听茼犭遽麸翳弪茱瘥猃汨狎簖茴鬻泔眄犷潲茱瘕鄄蓰茱鲥蝠蜷铘１２茱瘅埙殇翳蓰猃茴鬻泔眄犷潲茱瘅鄄蒇莒轭彗镝燧茱鲥蝠蜷铘髹１蓰２茱痤垲蓰猃茴鬻泔眄犷潲茱痤鄄蒇茔痨蓰茱鲥蝠蜷铘钲１蓰２瘴呐姨晌荃钿弪扉铄汨狎簖茯孱鬻泔眄犷潲荃钿弪扉铄郾蓰茱鲥蝠蜷铘苓１荃禧汨狎簖茴鬻泔眄犷潲荃忑郾蓰荃钿弪扉铄１荃钿弪扉铄骈祆茴鬻泔眄犷潲荃钿弪扉铄骈祆茱鲥蝠蜷铘鼷苓荃戽茴鬻泔眄犷潲荃戽茱鲥蝠蜷铘鼷苓荃钿弪扉铄茴鬻泔眄犷潲荃钿弪扉铄铨郾蒇茔痨蓰茱鲥蝠蜷铘钲１蓰苓荃祛茴鬻泔眄犷潲荃祛郾蒇茔痨蓰茱鲥蝠蜷铘钲１蓰苓现乓躺闻茱鲥蜢轭妍汨狎簖茯孱鬻泔眄犷潲茱鲥蜢轭妪郾蓰茱鲥蝠蜷铘茱溽箬１茱禧汨狎簖茴鬻泔眄犷潲茱忑郾蓰茱鲥蜢轭妍１茱鲥蜢轭彐殪茴鬻泔眄犷潲茱鲥蜢轭彐殪忑茱鲥蝠蜷铘鼷茱溽箬茱戽茴鬻泔眄犷潲茱戽茱鲥蝠蜷铘鼷茱溽箬茱鲥蜢轭孱茴鬻泔眄犷潲茱鲥蜢轭孱郾蒇茔痨蓰茱鲥蝠蜷铘钲１蓰茱溽箬茱祛茴鬻泔眄犷潲茱祛郾蒇茔痨蓰茱鲥蝠蜷铘钲１蓰茱溽箬釉疑伺险荏趄殡屣豸汨狎簖茴鬻泔眄犷潲荏趄殡屣豸郾蓰茱鲥蝠蜷铘茕狍椠１荏稃汨狎簖茴鬻泔眄犷潲荏稞郾蓰荏趄殡屣豸１荏趄殡屣豸骈祆茴鬻泔眄犷潲荏趄殡屣豸骈祆茱鲥蝠蜷铘鼷茕狍椠荏镦茴鬻泔眄犷潲荏镦茱鲥蝠蜷铘鼷茕狍椠荏趄殡屣豸茴鬻泔眄犷潲荏趄殡屣豸铨郾蒇茔痨蓰茱鲥蝠蜷铘钲１蓰茕狍椠荏镱茴鬻泔眄犷潲荏镱郾蒇茔痨蓰茱鲥蝠蜷铘钲１蓰茕狍椠ゥゥゥゥゥゥゥ葡彝猎陨吻ゥゥゥゥゥゥゥ荏腴痨轭遨茆狍屐轭弩腴疠轭箦螋鲥螋殂犰箴徙茴鬻泔眄犷潲荏腴痨轭妪郾蒇茆狍屐轭弩腴疠荟箴徙濯１茴鬻泔眄犷潲茼轵蝻蜩郾蓰荏汜戾怙饼郾蓰１茴鬻泔眄犷潲茼轵蝻蝣郾蓰茯衢箦怙茕屦翳荏汜戾怙饼郗陛１茴鬻泔眄犷潲茼轵蝻蜮雉椠郾蓰茯衢箦怙茕屦翳荏汜戾怙饼郗陛１茯殓梏怙圮疳蝮腴疠翦酏蜷玷舡犰殓铄扉铄镦翦蜥轶邃怡茆狍屐轭弩腴１翳溴驷蹯１轶莛狎箅轲麸瘐翳翦镱莛狎徵蜥痂扉铄徕秭茴鬻泔眄犷潲茯殓梏怙鄄蒇莛狎箅轲蓰茕彐荏疸茕轫屮痱１茯屐狲茼犭邂秫圮扉铄鏖漪栎垓蓰茯衢箦怙茆狍屐轭弩腴皤荏疸郯痿蒇梆糨２荟箴徙妍茆狍屐轭弩腴瘕荇徕疳蜊燧垓蓰翦酏箝铉戾疳蜥珧狃轭溴铘邃骝镯翳戾骠犷骝镯翳蜷玷怡犷汨狎徙翦蝮蝈箴邈糸鲥禊芪鬻娘沲礤铘蔑眄犷潲荇徕疳螨消荇徕汨狎簖消褒莛狎茴镩钿孱籁荑箴徙濯１茔栳蝼殇翳莛狎怙埕蓰莒轭鬻殇翳１茔栳蝼殇翳２茔栳蝼殇翳３荏趄豸莛狎芤羼蹰蝈嗅汶徵妍汨犷珏疳珏茆彗轭翎忖秫垤蒇蜉黹铋疳珏轭溴铘邃骝镯翳戾骠犷骝镯翳蜷玷怡犷汨狎徙翦蝮芪鬻娘沲礤铘蓬鲩蝻铐孱酐翎忖秫消荇徕汨狎簖消褒莛狎茴镩钿孱籁苌媛镲戾犷云１茆彗轭徜牾篝鏖漪瑾２茔栳蝼殇翳３茔栳蝼殇翳茆彗轭徜牾篝鏖漪椠２茔栳蝼殇翳３茔栳蝼殇翳苌媛镲戾犷云１苠钿徜牾篝鏖漪瑾苠钿徜牾篝鏖漪椠莛狎荑遽溴蜊骘蝽狒蓰翦酏坫栳蝮翦鏖翳汨狎骈祆轭翳扉铄芪鬻娘沲礤铘蔑眄犷潲荑遽溴螨消茆骟弪殄簖消苓莛狎１２荏趄豸莒轭彐殪燠３荪荃桢徜弪坻矧磲糨翦酏坫栳蝮筢礤狍荑遽溴颥鏖翳躅溴蜢轭邃翦芪鬻娘沲礤铘蔑眄犷潲荃桢徜弪消茆骟弪殄簖消苓莛狎荃禧１２荏趄豸莒轭彐殪燠３荪茆彗轭桢徜弪怙坻矧磲糨桢徜弪埕镳蒇怙趑镯翦怙鏖翳桢徜弪篚蝌秕钿邃怡扉铄芪鬻娘沲礤铘蓬鲩蝻铐孱酐桢徜弪怙消茆骟弪殄簖消苓消茱溽箬茕彐茆雉麸磴栳螓４莛狎１２荏趄豸莒轭彐殪燠３荪莛狎莒轭彐殪燠茆雉麸磴栳蜉茆彗轭蹊遽溴蜮秫坻矧磲糨桢徜弪埕镳蒇怙趑镯筢礤狍桢徜弪怙鏖翳躅溴蜢轭邃桢徜弪芪鬻娘沲礤铘蓬鲩蝻铐孱酐蹊遽溴蜮秫消茆骟弪殄簖消苓消茱溽箬茕彐茆雉麸磴栳螓４莛狎荃禧１２荏趄豸莒轭彐殪燠３荪莛狎莒轭彐殪燠茆雉麸磴栳蜉茆彗轭翦翕秫圮溽箬翦怙篚蝌秕钿邃怡麸犷怙趑镯扉铄芪鬻娘沲礤铘蓬鲩蝻铐孱酐翦翕秫消苓消茱溽箬茕彐茆雉麸磴栳螓２莛狎莒轭彐殪燠１荪莛狎莒轭彐殪燠茆雉麸磴栳蜉ゥゥゥゥゥゥ峙衣猎赏ゥゥゥゥゥゥ芤羼蹰蝈嗅汶徵妍驷钽鲵恺ゥゥゥゥゥ粤绿庞ゥゥゥゥゥ芤羼蹰蝈嗅汶徵妍翎怩灬蝤ボ磲脲狒戾趑弪ボ溴孳赭桁轭妍茼蹯糸泔祯眍芴岳泔祗忑莒轭邈栳蝼圮翦赭殇翳蓰苘ボ磲脲狒雉桢ボ铄縻镯磲钿荇麒扉铄鄢蒈翳屐轭邈栳蜉茴镝扉珙茼蹯糸泔祯眍２忑莒轭邈栳蝼郏陛３苘体骠犰殓铄泔祯眍茴鬻泔祯眍豉疱听佚缅铘弪邃泔祯眍茴鬻泔祯眍豉疱谬钧茔孱翦蜷铉茚蝌狴忉汶箪狍椠佚议玷舡犰殓铄泔祯眍茴鬻泔祯眍豉疱引钧茯徵珏潇彐糗狎蜥忉汶箪狍椠佚渝疳蜥麸蝮茴鬻泔祯眍豉疱利茴鬻泔祯眍豉疱利茕狍椠茴鬻泔祯眍豉疱啐利苓茴鬻泔祯眍豉疱摭利茱溽箬茴鬻泔祯眍豉疱利茴鬻泔祯眍豉疱{@{}}

\NewDocumentEnvironment{retrotable}{ O{LL} O{\linewidth} }{%
	\gdef\retrotablewidth{#2}
	\noindent\tabularx{#2}{#1}%
}{\endtabularx\noindent}


%%%%%%%%
% ENUM %
%%%%%%%%

\RequirePackage[inline]{enumitem}
\setlist{nosep, leftmargin=\tabwidth}
\renewcommand{\labelitemi}{*}
\renewcommand{\labelitemii}{\itshape*}
\renewcommand{\labelitemiii}{\itshape\textbullet}
\renewcommand{\labelitemiv}{\bfseries\textbullet}


%%%%%%%
% TOC %
%%%%%%%

% Enable for two-column TOC
%\RequirePackage[toc]{multitoc}

\renewcommand{\contentsname}{CONTENTS}

% \toc[n]
% print table of contents to the n-th depth
\newcommand{\toc}[1][1]{%
	\begingroup
	\let\cleardoublepage\relax
	\let\clearpage\relax
	\hyphenchar\font=-1% disable hyphenation
	\setcounter{tocdepth}{#1}\tableofcontents
	\thispagestyle{toc}
	\hyphenchar\font=`\-% enable hyphenation
	\endgroup
}

\RequirePackage{titletoc}
\RequirePackage[titles]{tocloft}% titles option - do not typeset ToC, LoF, LoT titles

% chapter
%\def\chapterautorefname{Chapter}
\titlecontents{chapter}
[0em]% left
{\bfseries}% above-code
{\thecontentslabel}% numbered-entry-format
{}%\makebox[\tocstep][l]{}}% numberless-entry-format
{\cftchapleader\quad\contentspage}% filler-page-format
[]% below-code

% section
\titlecontents{section}
[0pt]% left
{}% above-code
{\thecontentslabel}% numbered-entry-format
{}% numberless-entry-format
{\cftsecleader\quad\contentspage}% filler-page-format
[]% below-code

% subsection
\titlecontents{subsection}
[\dimexpr 4\charwidth\relax]% left
{}% above-code
{\thecontentslabel}% numbered-entry-format
{}% numberless-entry-format
{\cftsubsecleader\quad\contentspage}% filler-page-format
[]% below-code

% subsubsection
\titlecontents{subsubsection}
[\dimexpr 8\charwidth\relax]% left
{}% above-code
{\thecontentslabel}% numbered-entry-format
{}% numberless-entry-format
{\cftsubsubsecleader\quad\contentspage}% filler-page-format
[]% below-code

% paragraph
\titlecontents{paragraph}
[\dimexpr 12\charwidth\relax]% left
{}% above-code
{\thecontentslabel}% numbered-entry-format
{}% numberless-entry-format
{\cftparaleader\quad\contentspage}% filler-page-format
[]% below-code

% subparagraph
\titlecontents{subparagraph}
[\dimexpr 16\charwidth\relax]% left
{}% above-code
{\thecontentslabel}% numbered-entry-format
{}% numberless-entry-format
{\cftsubparaleader\quad\contentspage}% filler-page-format
[]% below-code


%%%%%%%%%%%%%%
% SECTIONING %
%%%%%%%%%%%%%%

% Titles
\RequirePackage[newlinetospace]{titlesec}

\newlength{\tocstep}
\setlength{\tocstep}{\tabchars\charwidth}% toc "tabbing" step distance

% hide section and subsection numbers in table of contents, along with corresponding indentation
\renewcommand{\thechapter}{}%{\arabic{chapter}.}
\renewcommand\thesection{}
\renewcommand\thesubsection{}

\makeatletter
\def\@seccntformat#1{\csname #1ignore\expandafter\endcsname\csname the#1\endcsname\quad}
\let\sectionignore\@gobbletwo
\let\latex@numberline\numberline
\def\numberline#1{\if\relax#1\relax\else\latex@numberline{#1}\fi}
\makeatother

\makeatletter
\newcommand{\ultitle}[1]{%
	\settowidth{\retrotype@strwidth}{#1}%
	\pgfmathaddtolength{\retrotype@strwidth}{\widthof{\chaptermark}}
	\makebox[0pt][l]{#1}%
	\linecharw[\_]{\retrotype@strwidth}%
}
\makeatother

\def\bchapskip{0pt}% before chapter skip
\def\achapskip{0pt}% after chapter skip
\def\bsecskip{0pt}% before section skip
\def\asecskip{0pt}% after section skip
\def\bsubsecskip{0pt}% before subsection skip
\def\asubsecskip{0pt}% after subsection skip
\def\bsubsubsecskip{0pt}% before subsubsection skip
\def\asubsubsecskip{0pt}% after subsubsection skip
\def\bparskip{0pt}% before paragraph skip
\def\aparskip{0pt}% after paragraph skip
\def\bsubparskip{0pt}% before subparagraph skip
\def\asubparskip{0pt}% after subparagraph skip


% set all titles' font size to \normalsize
\newcommand{\smalltitles}{%
	% skips
	\def\bchapskip{\parskip}
	\def\achapskip{\baselineskip}
	\def\bsecskip{0.5\baselineskip}
	\def\asecskip{0.5\baselineskip}
	\def\bsubsecskip{0.5\baselineskip}
	\def\asubsecskip{0.5\baselineskip}
	\def\bsubsubsecskip{0.5\baselineskip}
	\def\asubsubsecskip{0.5\baselineskip}
	\def\bparskip{\parskip}
	\def\aparskip{0ex}
	\def\bsubparskip{\parskip}
	\def\asubparskip{\wordsep}
	% chapter
	\titlespacing*{\chapter}{0em}{\bchapskip}{\achapskip}
	\titleformat{\chapter}
		{\centering\normalfont\bfseries\normalsize\MakeUppercase}{\thechapter}{0em}{\ul}
	% section
	\titlespacing*{\section}{0em}{\bsecskip}{\asecskip}
	\titleformat{\section}
		{\normalfont\bfseries\normalsize\MakeUppercase}{\thesection}{0em}{\ul}
	% subsection
	\titlespacing*{\subsection}{0em}{\bsubsecskip}{\asubsecskip}
	\titleformat{\subsection}
		{\normalfont\bfseries\normalsize\MakeUppercase}{\thesubsection}{0em}{}
	% subsubsection
	\titlespacing*{\subsubsection}{0em}{\bsubsubsecskip}{\asubsubsecskip}
	\titleformat{\subsubsection}
		{\normalfont\bfseries\normalsize}{\thesubsubsection}{0em}{}
	% paragraph
	\titlespacing*{\paragraph}{0em}{\bparskip}{\aparskip}
	\titleformat{\paragraph}
		{\normalfont\bfseries\normalsize}{\theparagraph}{0em}{}
	% subparagraph
	\titlespacing*{\subparagraph}{\parindent}{\bsubparskip}{\asubparskip}
	\titleformat{\subparagraph}[runin]
		{\normalfont\bfseries\normalsize}{\thesubparagraph}{0em}{}
}

% set varying font sizes for the titles (the default)
\newcommand{\largetitles}{%
	% skips
	\def\bchapskip{\parskip}
	\def\achapskip{\parskip}
	\def\bsecskip{\parskip}
	\def\asecskip{0.5\baselineskip}
	\def\bsubsecskip{0.5\baselineskip}
	\def\asubsecskip{0.5\baselineskip}
	\def\bsubsubsecskip{0.25\baselineskip}
	\def\asubsubsecskip{\parskip}
	\def\bparskip{\parskip}
	\def\aparskip{0ex}
	\def\bsubparskip{\parskip}
	\def\asubparskip{\wordsep}
	% chapter
	\titlespacing*{\chapter}{0em}{\bchapskip}{\achapskip}
	\titleformat{\chapter}
		{\centering\normalfont\bfseries\LARGE}{\thechapter}{0em}{}
	% section
	\titlespacing*{\section}{0em}{\bsecskip}{\asecskip}
	\titleformat{\section}
		{\normalfont\bfseries\Large}{\thesection}{0em}{}
	% subsection
	\titlespacing*{\subsection}{0em}{\bsubsecskip}{\asubsecskip}
	\titleformat{\subsection}
		{\normalfont\bfseries\large}{\thesubsection}{0em}{}
	% subsubsection
	\titlespacing*{\subsubsection}{0em}{\bsubsubsecskip}{\asubsubsecskip}
	\titleformat{\subsubsection}
		{\normalfont\bfseries\normalsize}{\thesubsubsection}{0em}{}
	% paragraph
	\titlespacing*{\paragraph}{0em}{\bparskip}{\aparskip}
	\titleformat{\paragraph}
		{\normalfont\bfseries\normalsize}{\theparagraph}{0em}{}
	% subparagraph
	\titlespacing*{\subparagraph}{\parindent}{\bsubparskip}{\asubparskip}
	\titleformat{\subparagraph}[runin]
		{\normalfont\bfseries\normalsize}{\thesubparagraph}{0em}{}
}

\largetitles{}

% unnumbered chapter with a TOC entry
\newcommand{\chapterx}[1]{%
	\chapter*{#1}
	\markboth{#1}{}
	\addcontentsline{toc}{chapter}{#1}%
}


%%%%%%%%%%%%
% FANCYHDR %
%%%%%%%%%%%%

\RequirePackage{fancyhdr}

\renewcommand{\headrule}{%
	\parbox[t]{\textwidth}{\linefill[\odash]}
}

% Change chaptermark

\renewcommand{\chaptermark}[1]{%
	\markboth{#1}{#1}}

%\renewcommand{\chaptermark}[1]{%
%	\markboth{\chaptername\ \thechapter\ #1}{}%
%}

% define fancy page style
\fancypagestyle{fancy}{%
	\fancyhf{}% clear headers and footers
	
	\fancyhead[LE,RO]{%
		{\nouppercase{\leftmark}}%
	}
	\fancyhead[LO,RE]{%
		{\title}%
	}
	\fancyfoot[LE]{%
		{\centering\thepage}
	}
	\fancyfoot[RO]{%
		{\centering\thepage}
	}
}

% toc page style
\fancypagestyle{toc}{%
	\fancyhf{}% clear headers and footers
	\fancyhead[LO,RE]{{\title}}
}

\fancypagestyle{plain}{}% redefine plain page style
\pagestyle{fancy}% set fancy page style


%%%%%%%%%%
% IMAGES %
%%%%%%%%%%

% BLEND MODES:
% normal
% multiply
% screen
% overlay
% darken
% lighten
% color dodge
% color burn
% hard light
% soft light
% difference
% exclusion
% hue
% saturation
% color
% luminosity

% shortcuts
\newcommand{\addBg}[1]{\AddToShipoutPictureBG{#1}}
\newcommand{\addFg}[1]{\AddToShipoutPictureFG{#1}}
\newcommand{\clearBg}{\ClearShipoutPictureBG{}}
\newcommand{\clearFg}{\ClearShipoutPictureFG{}}

% \pageFill[opacity][blend]{color}
%
% #1	(optional) color opacity (default = 1.0)
% #2	(optional) blend mode (default = mormal)
% #3	color
%
\NewDocumentCommand{\pageFill}{ O{1.0} O{normal} m }{%
	\begin{tikzpicture}[remember picture,overlay]
		\begin{scope}[blend mode=#2]
			\fill[#3, opacity=#1] (current page.south west) rectangle (current page.north east);
		\end{scope}
	\end{tikzpicture}
}

\newsavebox{\ImgBox}
\newlength{\ImgW}
\newlength{\ImgH}
\newlength{\ImgX}
\newlength{\ImgY}

% \pageCenter[opacity][blend]{file}[scale]
%
% #1	(optional)	opacity (default = 1.0)
% #2	(optional)	blend mode (default = normal)
% #3	image file
% #4	(optional)	scale (default = 1.0)
%
\NewDocumentCommand{\pageCenter}{ O{1.0} O{normal} m O{1.0} }{%
	\begin{tikzpicture}[remember picture,overlay]
		\begin{scope}[opacity=#1, blend mode=#2]
			\node[inner sep=0pt] at (current page.center)
			{\includegraphics[scale=#4]{#3}};
		\end{scope}
	\end{tikzpicture}
}

% \pageStretch[opacity][blend]{file}[ratio]
%
% #1	(optional)	opacity (default = 1.0)
% #2	(optional)	blend mode (default = normal)
% #3	image file
% #4	(optional)	keep aspect ratio (default = 1, make 0 to ignore)
%
\NewDocumentCommand{\pageStretch}{ O{1.0} O{normal} m O{1} }{%
	\begin{tikzpicture}[remember picture,overlay]
		\begin{scope}[opacity=#1, blend mode=#2]
			\node[inner sep=0pt] at (current page.center)
			{%
				\if1#4%
					\includegraphics[width=\pdfpagewidth,height=\pdfpageheight,keepaspectratio]{#3}
				\else%
					\includegraphics[width=\pdfpagewidth,height=\pdfpageheight]{#3}
				\fi
			};
		\end{scope}
	\end{tikzpicture}
}

\newcommand{\setTileOffsetLength}[3]{%
	\pgfmathsetlength{#1}{- #3 + mod(#2, #3) / 2}%
}

% \pageTiles[opacity][blend]{file}[scale]
%
% #1	(optional)	opacity (default = 1.0)
% #2	(optional)	blend mode (default = normal)
% #3	image file
% #4	(optional)	scale (default = 1.0)
%
\NewDocumentCommand{\pageTiles}{ O{1.0} O{normal} m O{1.0} }{%
	% load image
	\sbox{\ImgBox}{\includegraphics[scale=#4]{#3}}
	% get image dimensions
	\settowidth{\ImgW}{\usebox{\ImgBox}}%
	\settoheight{\ImgH}{\usebox{\ImgBox}}%
	% set initial drawing coordinates and draw tiles
	\setTileOffsetLength{\ImgY}{\paperheight}{\ImgH}%
	%
	\begin{tikzpicture}[remember picture,overlay]
		\begin{scope}[opacity=#1, blend mode=#2]
			\whiledo{\lengthtest{\ImgY < \paperheight}}{%
				\setTileOffsetLength{\ImgX}{\paperwidth}{\ImgW}%
				\whiledo{\lengthtest{\ImgX < \paperwidth}}{%
					\put(\ImgX\@gobble, \ImgY\@gobble){%
						\includegraphics[width=\ImgW,height=\ImgH]{#3}
					}%
					\pgfmathaddtolength{\ImgX}{\ImgW}
				}% whiledo X
				\pgfmathaddtolength{\ImgY}{\ImgH}
			}% whiledo Y
		\end{scope}
	\end{tikzpicture}
}
